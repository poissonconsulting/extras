<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Beta-binomial Deviance Residuals • extras</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../katex-auto.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Roboto_Condensed-0.4.9/font.css" rel="stylesheet">
<link href="../deps/Roboto_Mono-0.4.9/font.css" rel="stylesheet">
<link href="../deps/Playfair_Display-0.4.9/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><link href="../deps/KaTex-0.16.10/katex.min.css" rel="stylesheet">
<script src="../deps/KaTex-0.16.10/katex.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Beta-binomial Deviance Residuals">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">extras</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.8.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/beta-binomial-deviance-residuals.html">Beta-binomial Deviance Residuals</a></li>
    <li><a class="dropdown-item" href="../articles/deviance-residuals.html">Deviance Residuals</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/poissonconsulting/extras/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Beta-binomial Deviance Residuals</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/poissonconsulting/extras/blob/v0.8.0/vignettes/beta-binomial-deviance-residuals.Rmd" class="external-link"><code>vignettes/beta-binomial-deviance-residuals.Rmd</code></a></small>
      <div class="d-none name"><code>beta-binomial-deviance-residuals.Rmd</code></div>
    </div>

    
    
<div class="section level3">
<h3 id="beta-binomial-distribution">Beta-binomial distribution<a class="anchor" aria-label="anchor" href="#beta-binomial-distribution"></a>
</h3>
<p>The beta-binomial distribution is useful when we wish to incorporate
additional variation into the probability parameter of the binomial
distribution, <span class="math inline">p</span>. It accomplishes this
by drawing <span class="math inline">p</span> from a beta distribution.
The parameters of the beta-binomial are the number of trials, <span class="math inline">n</span>, and the shape parameters of the beta
distribution, <span class="math inline">\alpha</span> and <span class="math inline">\beta</span>.</p>
<p>The likelihood of the beta-binomial can be described as follows:
<span class="math display">P(x | n, \alpha, \beta) = \frac{\Gamma(n +
1)}{\Gamma(x + 1)\Gamma(n - x + 1)}
\frac{\Gamma(x + \alpha) \Gamma(n - x + \beta)}{\Gamma(n + \alpha +
\beta)}
\frac{\Gamma(\alpha + \beta)}{\Gamma(\alpha) \Gamma(\beta)},</span>
where <span class="math inline">x</span> is a natural number <span class="math inline">≤ n</span>, <span class="math inline">\alpha</span>
and <span class="math inline">\beta</span> are <span class="math inline">&gt;0</span>, and where <span class="math inline">\Gamma()</span> represents the gamma function.</p>
<p>The log-likelihood is:<br><span class="math display">\log(P(x | n, \alpha, \beta)) = \log(\Gamma(n
+ 1)) - \log(\Gamma(x + 1)) - \log(\Gamma(n - x + 1)) +
   \log(\Gamma(x + \alpha)) + \\ \log(\Gamma(n - x + \beta)) -
\log(\Gamma(n + \alpha + \beta)) +
    \log(\Gamma(\alpha + \beta)) - \log(\Gamma(\alpha)) -
\log(\Gamma(\beta)).</span></p>
<p>The expected value of the beta-binomial distribution is <span class="math inline">n \cdot \frac{\alpha}{\alpha + \beta}</span>. This
is the same as the expected value of the binomial distribution (<span class="math inline">n \cdot p</span>), with the <span class="math inline">p</span> replaced by the expected value of the beta
distribution, <span class="math inline">\frac{\alpha}{\alpha +
\beta}</span>.</p>
<p>A parameterization frequently used for the beta-binomial distribution
uses this expected probability (<span class="math inline">p</span>) as a
parameter, with a dispersion parameter (<span class="math inline">\theta</span>) that specifies the variance in the
probability. Our particular parameterization of <span class="math inline">\theta</span> is slightly unconventional, but has
useful properties when modelling. When <span class="math inline">\theta
= 0</span>, the beta-binomial reverts to the binomial distribution. When
<span class="math inline">\theta = 1</span> and <span class="math inline">p = 0.5</span>, the parameters of the beta
distribution become <span class="math inline">\alpha = 1</span> and
<span class="math inline">\beta = 1</span>, which correspond to a
uniform distribution for the beta-binomial probability parameter.</p>
<p>The relationships between <span class="math inline">p</span> and
<span class="math inline">\theta</span> and <span class="math inline">\alpha</span> and <span class="math inline">\beta</span> are defined as follows:<br><span class="math display">p = \frac{\alpha}{\alpha + \beta}</span>
<span class="math display">\theta = \frac{2}{\alpha + \beta}</span></p>
<p><span class="math display">\alpha = 2\cdot\frac{p}{\theta}</span>
<span class="math display">\beta = 2\cdot\frac{1 - p}{\theta}</span></p>
</div>
<div class="section level3">
<h3 id="deviance">Deviance:<a class="anchor" aria-label="anchor" href="#deviance"></a>
</h3>
<p>Recall that the likelihood of a model is the probability of the data
set given the model (<span class="math inline">P(\text{data}|\text{model})</span>). The
<em>deviance</em> of a model, <span class="math inline">D</span>, is
defined by: <span class="math display">D(\text{model},\text{data}) =
2(\log(P(\text{data}|\text{saturated model})) -
\log(P(\text{data}|\text{fitted model}))),</span> where the saturated
model is the model that perfectly fits the data.</p>
<p>The saturated model usually uses the value of <span class="math inline">x</span> in place of the mean parameter, thereby
fitting through the data points. For example, calculating the saturated
log-likelihood of the normal distribution involves using the <span class="math inline">x</span> value(s) in place of the mean parameter
<span class="math inline">\mu</span> in the log-likelihood. Recall from
above that the expected value of the binomial distribution is <span class="math inline">n \cdot p</span>. Since <span class="math inline">n</span> is fixed in the binomial distribution,
<span class="math inline">p = \frac{x}{n}</span> is used to calculate
the saturated log-likelihood.</p>
<p>In the case of the beta-binomial distribution, there is some
confusion about what should be used as the saturated model. One
suggested approach is to use the saturated log-likelihood of the
binomial distribution, as described above, effectively setting the <span class="math inline">\theta</span> dispersion term to 0. A second
suggested approach is to use the same method as described for the
binomial distribution (i.e., replacing <span class="math inline">p</span> with <span class="math inline">\frac{x}{n}</span>), and holding the <span class="math inline">\theta</span> value constant. Both of these
approaches have issues.</p>
<p>The problem with the first approach is that likelihood profile of the
beta-binomial becomes increasingly dispersed relative to the binomial as
<span class="math inline">\theta</span> increases (Fig. 1).
Consequently, increasing <span class="math inline">\theta</span>
increases the deviance even if the expected value of the fitted model is
the same as the saturated binomial model.</p>
<div class="figure">
<img src="beta-binomial-deviance-residuals_files/figure-html/unnamed-chunk-3-1.png" alt="Fig. 1: Beta-binomial likelihood profile for $x = 1$ and $n = 5$, for different values of $\theta$. $\theta = 0$ corresponds to the binomial case." width="672"><p class="caption">
Fig. 1: Beta-binomial likelihood profile for <span class="math inline">x
= 1</span> and <span class="math inline">n = 5</span>, for different
values of <span class="math inline">\theta</span>. <span class="math inline">\theta = 0</span> corresponds to the binomial case.
</p>
</div>
<p>The problem with the second approach is that for some combinations of
<span class="math inline">p</span> and <span class="math inline">\theta</span>, the resultant deviance values are
negative. This is an issue for two reasons. Firstly, it is nonsensical
because by definition the saturated model should be the best possible
fit to the data. Secondly, it is computationally problematic, because
calculating deviance residuals, as we will do in the next section,
involves taking the square root of the deviance.</p>
<p>Here is an example of a case where the deviance is negative. Using
<span class="math inline">x = 1</span>, <span class="math inline">n =
5</span>, <span class="math inline">p = 0.3</span>, and <span class="math inline">\theta = 0.5</span>, we calculate the saturated
log-likelihood:</p>
<p><span class="math display">\alpha_{sat} = \frac{2
(\frac{x}{n})}{\theta} = \frac{2(0.3)}{0.5} = 0.8</span> <span class="math display">\beta_{sat} = \frac{2 (1 - \frac{x}{n})}{\theta} =
\frac{2 (1 - 0.3)}{0.5} = 3.2</span></p>
<p><span class="math display"> \log(P(x|n, p_{sat}, \theta_{sat}) =
-1.355106,</span></p>
<p>the fitted log-likelihood:</p>
<p><span class="math display">\alpha_{fit} = \frac{2 (p)}{\theta} =
\frac{2(0.3)}{0.5} = 1.2</span> <span class="math display">\beta_{fit} =
\frac{2 (1 - p)}{\theta} = \frac{2 (1 - 0.3}{0.5} = 2.8</span></p>
<p><span class="math display">\log(P(x|n, p_{fit}, \theta_{fit})) =
-1.32999,</span></p>
<p>and finally, the deviance:</p>
<span class="math display">\begin{aligned}
D(n, p, \theta, x) &amp;= 2(\log(P(x|n, p_{sat}, \theta_{sat})) -
\log(P(x|n, p_{fit}, \theta_{fit}))) \\
&amp;= 2(-1.355106 - -1.32999) \\
&amp;= -0.050232.
\end{aligned}</span>
<p>In summary, the deviance is negative because the likelihood at the
expected value, <span class="math inline">p = \frac{x}{n}</span> is less
than the likelihood of the observed value (Fig. 2).</p>
<p>The solution to the problem appears to be to choose the value of
<span class="math inline">p</span> that maximizes the likelihood.
However, the beta-binomial distribution has closed-form solutions only
for certain values of <span class="math inline">\alpha</span> and <span class="math inline">\beta</span>. Thus, we must generally search for the
value of <span class="math inline">p</span> that maximizes the
likelihood for each data point in order to calculate the saturated
log-likelihood. We will refer to the optimized <span class="math inline">p</span> value for the <span class="math inline">i^{th}</span> data point as <span class="math inline">p_i^*</span>, and generally as <span class="math inline">p^*</span>. We use <span class="math inline">p^*</span> to calculate the saturated log-likelihood
that produces deviances that are (a) strictly positive, and (b) relative
to the value of <span class="math inline">\theta</span>. The value of
<span class="math inline">p_i^*</span> for the example case with <span class="math inline">x = 1</span>, <span class="math inline">n =
5</span>, and <span class="math inline">\theta = 0.5</span> is shown in
Figure 2.</p>
<div class="figure">
<img src="beta-binomial-deviance-residuals_files/figure-html/unnamed-chunk-4-1.png" alt="Fig. 2: Beta-binomial likelihood profile for $x = 1$, $n = 5$, and $\theta = 0.5$. The dashed vertical line shows the likelihood at the expected value of the beta-binomial distribution ($n \cdot p$) where $p = \frac{x}{n} = \frac{1}{5} = 0.2$. As you can see, this is not the $p$ for which the likelihood is maximized. The solid vertical line shows the likelihood at its maximum point. In this case, $p^* = 0.26$." width="672"><p class="caption">
Fig. 2: Beta-binomial likelihood profile for <span class="math inline">x
= 1</span>, <span class="math inline">n = 5</span>, and <span class="math inline">\theta = 0.5</span>. The dashed vertical line shows
the likelihood at the expected value of the beta-binomial distribution
(<span class="math inline">n \cdot p</span>) where <span class="math inline">p = \frac{x}{n} = \frac{1}{5} = 0.2</span>. As you
can see, this is not the <span class="math inline">p</span> for which
the likelihood is maximized. The solid vertical line shows the
likelihood at its maximum point. In this case, <span class="math inline">p^* = 0.26</span>.
</p>
</div>
</div>
<div class="section level3">
<h3 id="deviance-residuals">Deviance residuals<a class="anchor" aria-label="anchor" href="#deviance-residuals"></a>
</h3>
<p>The unit deviance, <span class="math inline">d_i</span> refers to the
deviance for the <span class="math inline">i^{th}</span> data point,
<span class="math inline">x_i</span>:<br><span class="math display">d_i =  2(\log(P(x_i|n, p_i^*, \theta)) -
\log(P(x_i|n, p, \theta))).</span> The <em>deviance residual</em> is the
signed squared root of the unit deviance,<br><span class="math display">r_i = \text{sign}(x_i - (n p_i^*))
\sqrt{d_i}.</span> The following plot shows histograms of deviance
residuals for 10,000 randomly generated data points with <span class="math inline">n = 50</span> and various values of <span class="math inline">p</span> and <span class="math inline">\theta</span>.</p>
<div class="figure">
<img src="beta-binomial-deviance-residuals_files/figure-html/unnamed-chunk-5-1.png" alt="Fig. 4: Histograms of deviance residuals for 10,000 beta-binomial data points simulated with $n = 50$, $p = \{0.3, 0.5, 0.9 \}$, and $\theta = \{0.0, 0.1, 0.5, 1.0 \}$. The percentages within each panel (i.e., each combination of $p$ and $\theta$) sum to 100%." width="672"><p class="caption">
Fig. 4: Histograms of deviance residuals for 10,000 beta-binomial data
points simulated with <span class="math inline">n = 50</span>, <span class="math inline">p = \{0.3, 0.5, 0.9 \}</span>, and <span class="math inline">\theta = \{0.0, 0.1, 0.5, 1.0 \}</span>. The
percentages within each panel (i.e., each combination of <span class="math inline">p</span> and <span class="math inline">\theta</span>) sum to 100%.
</p>
</div>
<p>Recall that <span class="math inline">\theta = 0</span> refers to the
binomial case. When <span class="math inline">p = 0.5</span> and <span class="math inline">\theta &gt; 0</span>, deviance residuals close to 0
become less common; as <span class="math inline">\theta</span>
increases, the distribution of deviance residuals becomes less
continuous (Fig. 4). When <span class="math inline">p</span> deviates
from <span class="math inline">0.5</span> and <span class="math inline">\theta &gt; 0</span>, the distribution of the
deviance residuals becomes increasingly skewed and discontinuous (Fig.
4).</p>
<p>Due to the skewed and discontinuous nature of the distribution of the
deviance residuals, the goodness of fit of a beta-binomial model cannot
be assessed from the deviance residuals alone but must be evaluated
using posterior predictive checking.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Nicole Hill, <a href="https://www.poissonconsulting.ca/author/joe-thorley/" class="external-link">Joe Thorley</a>, <a href="https://www.poissonconsulting.ca/" class="external-link"><img src="https://github.com/poissonconsulting.png" height="24" alt=""></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
